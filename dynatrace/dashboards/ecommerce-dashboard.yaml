# Dynatrace Dashboard Configuration for E-commerce Demo
dashboard:
  name: "E-commerce Demo Dashboard"
  description: "Comprehensive monitoring dashboard for e-commerce application"
  tags:
    - "ecommerce"
    - "demo"
    - "microservices"
  
  tiles:
    - name: "API Gateway Response Time"
      type: "TIMESERIES"
      query: |
        fetch metrics
        | filter metricId == "builtin:service.response.time"
        | filter service.name == "ecommerce-api-gateway"
        | summarize avg_response_time = avg(value) by timestamp
      visualization:
        type: "line"
        yAxis:
          min: 0
          max: 2000
    
    - name: "Service Health Status"
      type: "STATUS"
      query: |
        fetch logs
        | filter log.source == "health-check"
        | filter content contains "HEALTHY" or content contains "UNHEALTHY"
        | summarize health_status = any(content) by service.name
      visualization:
        type: "status"
        colorThresholds:
          - value: "HEALTHY"
            color: "green"
          - value: "UNHEALTHY"
            color: "red"
    
    - name: "Database Connection Pool"
      type: "TIMESERIES"
      query: |
        fetch metrics
        | filter metricId == "custom:database.connections.active"
        | filter service.name contains "ecommerce"
        | summarize active_connections = avg(value) by timestamp
      visualization:
        type: "area"
        yAxis:
          min: 0
          max: 100
    
    - name: "Error Rate by Service"
      type: "PIE_CHART"
      query: |
        fetch logs
        | filter content contains "ERROR"
        | filter log.source contains "ecommerce"
        | summarize error_count = count() by service.name
      visualization:
        type: "pie"
    
    - name: "Order Processing Metrics"
      type: "TIMESERIES"
      query: |
        fetch metrics
        | filter metricId == "custom:ecommerce.orders.processed"
        | summarize orders_per_minute = rate(value) by timestamp
      visualization:
        type: "bar"
        yAxis:
          min: 0
    
    - name: "Payment Success Rate"
      type: "SINGLE_VALUE"
      query: |
        fetch metrics
        | filter metricId == "custom:ecommerce.payment.success_rate"
        | summarize success_rate = avg(value) by timestamp
      visualization:
        type: "gauge"
        thresholds:
          - value: 95
            color: "green"
          - value: 90
            color: "yellow"
          - value: 0
            color: "red"
    
    - name: "Memory Usage by Service"
      type: "TIMESERIES"
      query: |
        fetch metrics
        | filter metricId == "builtin:host.memory.usage"
        | filter service.name contains "ecommerce"
        | summarize memory_usage = avg(value) by service.name, timestamp
      visualization:
        type: "stacked_line"
        yAxis:
          min: 0
          max: 100
    
    - name: "CPU Usage by Service"
      type: "TIMESERIES"
      query: |
        fetch metrics
        | filter metricId == "builtin:host.cpu.usage"
        | filter service.name contains "ecommerce"
        | summarize cpu_usage = avg(value) by service.name, timestamp
      visualization:
        type: "stacked_line"
        yAxis:
          min: 0
          max: 100
    
    - name: "Active Users"
      type: "SINGLE_VALUE"
      query: |
        fetch logs
        | filter content contains "user_login"
        | filter timestamp >= now() - 1h
        | summarize active_users = count_distinct(user_id)
      visualization:
        type: "number"
    
    - name: "Top Products by Views"
      type: "TABLE"
      query: |
        fetch logs
        | filter content contains "product_view"
        | filter timestamp >= now() - 24h
        | summarize view_count = count() by product_id
        | sort view_count desc
        | limit 10
      visualization:
        type: "table"
    
    - name: "CI/CD Pipeline Status"
      type: "STATUS"
      query: |
        fetch logs
        | filter log.source == "harness" or log.source == "jenkins"
        | filter content contains "PIPELINE_STATUS"
        | summarize pipeline_status = any(content) by pipeline_name
      visualization:
        type: "status"
        colorThresholds:
          - value: "SUCCESS"
            color: "green"
          - value: "FAILED"
            color: "red"
          - value: "RUNNING"
            color: "blue"
    
    - name: "Deployment Frequency"
      type: "TIMESERIES"
      query: |
        fetch logs
        | filter content contains "DEPLOYMENT_COMPLETE"
        | filter timestamp >= now() - 7d
        | summarize deployments = count() by bin(timestamp, 1d)
      visualization:
        type: "bar"
    
    - name: "Mean Time to Recovery"
      type: "SINGLE_VALUE"
      query: |
        fetch logs
        | filter content contains "INCIDENT_RESOLVED"
        | filter timestamp >= now() - 30d
        | summarize avg_recovery_time = avg(recovery_time)
      visualization:
        type: "duration"
